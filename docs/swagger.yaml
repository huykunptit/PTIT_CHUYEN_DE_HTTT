openapi: 3.0.3
info:
  title: Cinemat API
  version: 1.0.0
  description: |
    Tài liệu OpenAPI cho hệ thống đặt vé Cinemat. Các endpoint dưới đây bao gồm
    nhóm API phim công khai (không yêu cầu đăng nhập) và nhóm API thông báo nội bộ
    (yêu cầu người dùng đã đăng nhập thông qua session Laravel).
servers:
  - url: https://cinemat.local
    description: Môi trường phát triển nội bộ
  - url: https://cinemat.example.com
    description: Môi trường sản xuất
tags:
  - name: Movies
    description: Tra cứu dữ liệu phim đồng bộ với TMDB
  - name: Notifications
    description: Quản lý thông báo realtime cho người dùng đăng nhập
  - name: Auth
    description: Đăng nhập/đăng ký và xác thực danh tính người dùng
  - name: Frontend
    description: Trang web công khai cho khách truy cập
  - name: Booking
    description: Đặt vé, quản lý vé cho người dùng cuối
  - name: Payment
    description: Quy trình thanh toán VNPay và sandbox demo
  - name: Check-in
    description: Quét mã vé và xác thực vé
  - name: Tickets
    description: Xem vé đã đặt và chi tiết vé
  - name: My Tickets
    description: Trung tâm vé cá nhân (người dùng đã đăng nhập)
  - name: Admin
    description: Bảng điều khiển quản trị và thao tác CRUD
  - name: Staff
    description: Quyền thao tác của nhân viên quầy vé/soát vé
  - name: Broadcast
    description: Endpoint xác thực Pusher/Laravel Echo
components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: laravel_session
      description: |
        Cookie session Laravel (cần kèm thêm XSRF-TOKEN đối với request POST/PUT/PATCH/DELETE).
  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required:
        - success
    Movie:
      type: object
      properties:
        id:
          type: integer
          example: 653346
        title:
          type: string
          example: Dune: Part Two
        original_title:
          type: string
        overview:
          type: string
        poster_path:
          type: string
          nullable: true
          description: Đường dẫn poster tương đối trả về từ TMDB
        backdrop_path:
          type: string
          nullable: true
        release_date:
          type: string
          format: date
        language:
          type: string
          example: vi-VN
        vote_average:
          type: number
          format: float
        vote_count:
          type: integer
        popularity:
          type: number
          format: float
        runtime:
          type: integer
          nullable: true
          description: Thời lượng (phút)
        genres:
          type: array
          items:
            $ref: '#/components/schemas/Genre'
        videos:
          type: array
          description: Danh sách trailer/clip (nếu có)
          items:
            type: object
            properties:
              key:
                type: string
              site:
                type: string
                example: YouTube
              type:
                type: string
                example: Trailer
    Genre:
      type: object
      properties:
        id:
          type: integer
          example: 28
        name:
          type: string
          example: Hành động
    MovieListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                page:
                  type: integer
                  example: 1
                total_pages:
                  type: integer
                  example: 15
                total_results:
                  type: integer
                  example: 300
                results:
                  type: array
                  items:
                    $ref: '#/components/schemas/Movie'
            message:
              type: string
              example: Lấy danh sách phim đang chiếu thành công
          required:
            - data
    MovieDetailsResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/Movie'
            message:
              type: string
              example: Lấy chi tiết phim thành công
          required:
            - data
    GenreListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Genre'
            message:
              type: string
              example: Lấy danh sách thể loại thành công
          required:
            - data
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          example: App\Notifications\BookingCreated
        data:
          type: object
          description: Payload tùy thuộc loại thông báo (ví dụ thông tin vé, mã đặt chỗ...)
        read_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - type
        - data
        - created_at
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        remember:
          type: boolean
          default: false
    RegisterRequest:
      type: object
      required:
        - name
        - email
        - phone
        - password
        - password_confirmation
        - terms
      properties:
        name:
          type: string
          maxLength: 255
        email:
          type: string
          format: email
        phone:
          type: string
          maxLength: 20
        password:
          type: string
          format: password
          minLength: 8
        password_confirmation:
          type: string
          format: password
        terms:
          type: boolean
          description: Người dùng phải chấp nhận điều khoản
    PhoneOtpRequest:
      type: object
      required:
        - phone
      properties:
        phone:
          type: string
          description: Số điện thoại đăng ký trong hệ thống
    PhoneOtpVerifyRequest:
      type: object
      required:
        - phone
        - otp
      properties:
        phone:
          type: string
        otp:
          type: string
          pattern: '^\d{6}$'
    BookingRequest:
      type: object
      required:
        - showtime_id
        - seat_ids
      properties:
        showtime_id:
          type: integer
        seat_ids:
          type: array
          minItems: 1
          items:
            type: integer
    PaymentMethodRequest:
      type: object
      required:
        - payment_method
      properties:
        payment_method:
          type: string
          enum:
            - vnpay_qr
            - vnpay_atm
            - vnpay_card
    DemoPaymentRequest:
      type: object
      properties:
        method:
          type: string
          enum:
            - vnpay_qr
            - vnpay_atm
            - vnpay_card
          default: vnpay_qr
        action:
          type: string
          enum:
            - success
            - cancel
          default: success
    CheckInRequest:
      type: object
      required:
        - ticket_code
      properties:
        ticket_code:
          type: string
          minLength: 10
          maxLength: 10
          description: Mã vé in trên ticket (ví dụ TKABC12345)
    Seat:
      type: object
      properties:
        id:
          type: integer
        row:
          type: string
          example: A
        number:
          type: integer
          example: 5
        type:
          type: string
          example: VIP
        price:
          type: number
          format: float
    Ticket:
      type: object
      properties:
        id:
          type: integer
        ticket_code:
          type: string
          example: TK3F2X9AB
        status:
          type: string
          enum:
            - BOOKED
            - SOLD
            - USED
            - AVAILABLE
        seat:
          $ref: '#/components/schemas/Seat'
        checked_in_at:
          type: string
          format: date-time
          nullable: true
    BookingResource:
      type: object
      properties:
        id:
          type: integer
        booking_code:
          type: string
          example: BK8N2LKQZ
        status:
          type: string
          enum:
            - PENDING
            - CONFIRMED
            - CANCELLED
            - EXPIRED
        total_amount:
          type: number
          format: float
        final_amount:
          type: number
          format: float
        payment_method:
          type: string
          nullable: true
        payment_status:
          type: string
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
        showtime_id:
          type: integer
        user_id:
          type: integer
          nullable: true
        tickets:
          type: array
          items:
            $ref: '#/components/schemas/Ticket'
    AdminMovieRequest:
      type: object
      required:
        - title
        - description
        - duration
        - genre
        - country
        - language
        - age_rating
        - release_date
        - end_date
        - status
      properties:
        title:
          type: string
          maxLength: 255
        description:
          type: string
        duration:
          type: integer
          minimum: 1
        genre:
          type: string
        country:
          type: string
        language:
          type: string
        age_rating:
          type: integer
          enum:
            - 0
            - 13
            - 16
            - 18
        release_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        status:
          type: string
          enum:
            - COMING_SOON
            - NOW_SHOWING
            - ENDED
        rating:
          type: number
          format: float
          nullable: true
        trailer_url:
          type: string
          format: uri
          nullable: true
        is_featured:
          type: boolean
          default: false
    CinemaRequest:
      type: object
      required:
        - name
        - address
        - city
        - phone
      properties:
        name:
          type: string
        address:
          type: string
        city:
          type: string
          enum:
            - HCM
            - HN
        phone:
          type: string
        email:
          type: string
          format: email
          nullable: true
        description:
          type: string
          nullable: true
        is_active:
          type: boolean
          default: true
    RoomRequest:
      type: object
      required:
        - cinema_id
        - name
        - capacity
        - type
      properties:
        cinema_id:
          type: integer
        name:
          type: string
        capacity:
          type: integer
          minimum: 1
          maximum: 500
        type:
          type: string
          enum:
            - STANDARD
            - VIP
            - IMAX
            - 4DX
        is_active:
          type: boolean
          default: true
    ShowtimeRequest:
      type: object
      required:
        - movie_id
        - room_id
        - date
        - start_time
        - end_time
        - status
      properties:
        movie_id:
          type: integer
        room_id:
          type: integer
        date:
          type: string
          format: date
        start_time:
          type: string
          pattern: '^\d{2}:\d{2}$'
        end_time:
          type: string
          pattern: '^\d{2}:\d{2}$'
        status:
          type: string
          enum:
            - ACTIVE
            - CANCELLED
            - COMPLETED
    AdminBookingUpdateRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - PENDING
            - CONFIRMED
            - CANCELLED
            - EXPIRED
        payment_method:
          type: string
          nullable: true
        payment_status:
          type: string
          nullable: true
    InlineStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - PENDING
            - CONFIRMED
            - CANCELLED
            - EXPIRED
    StaffBookingStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - PENDING
            - CONFIRMED
            - CANCELLED
            - COMPLETED
  parameters:
    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Trang dữ liệu TMDB
    Language:
      name: language
      in: query
      schema:
        type: string
        default: vi-VN
      description: Mã ngôn ngữ TMDB
paths:
  /api/movies/now-playing:
    get:
      tags:
        - Movies
      summary: Danh sách phim đang chiếu
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '500':
          description: Lỗi server hoặc không có dữ liệu
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
  /api/movies/upcoming:
    get:
      tags:
        - Movies
      summary: Danh sách phim sắp chiếu
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '500':
          $ref: '#/paths/~1api~1movies~1now-playing/get/responses/500'
  /api/movies/popular:
    get:
      tags:
        - Movies
      summary: Danh sách phim phổ biến
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '500':
          $ref: '#/paths/~1api~1movies~1now-playing/get/responses/500'
  /api/movies/search:
    get:
      tags:
        - Movies
      summary: Tìm kiếm phim theo từ khóa
      parameters:
        - in: query
          name: q
          schema:
            type: string
          required: true
          description: Từ khóa tìm kiếm
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '400':
          description: Thiếu từ khóa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          $ref: '#/paths/~1api~1movies~1now-playing/get/responses/500'
  /api/movies/{movieId}:
    get:
      tags:
        - Movies
      summary: Chi tiết phim
      parameters:
        - in: path
          name: movieId
          schema:
            type: integer
          required: true
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieDetailsResponse'
        '500':
          $ref: '#/paths/~1api~1movies~1now-playing/get/responses/500'
  /api/movies/genres:
    get:
      tags:
        - Movies
      summary: Danh sách thể loại phim
      parameters:
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenreListResponse'
        '500':
          $ref: '#/paths/~1api~1movies~1now-playing/get/responses/500'
  /api/movies/genre/{genreId}:
    get:
      tags:
        - Movies
      summary: Danh sách phim theo thể loại
      parameters:
        - in: path
          name: genreId
          schema:
            type: integer
          required: true
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Language'
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovieListResponse'
        '500':
          $ref: '#/paths/~1api~1movies~1now-playing/get/responses/500'
  /api/movies/clear-cache:
    post:
      tags:
        - Movies
      summary: Xóa cache dữ liệu phim TMDB
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
  /api/notifications:
    get:
      tags:
        - Notifications
      summary: Lấy 10 thông báo mới nhất của người dùng
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Danh sách thông báo theo thứ tự mới nhất
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'
        '401':
          description: Chưa đăng nhập
  /api/notifications/unread-count:
    get:
      tags:
        - Notifications
      summary: Đếm số thông báo chưa đọc
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Số lượng chưa đọc
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    example: 3
        '401':
          description: Chưa đăng nhập
  /api/notifications/{id}/read:
    post:
      tags:
        - Notifications
      summary: Đánh dấu 1 thông báo đã đọc
      parameters:
        - in: path
          name: id
          schema:
            type: string
            format: uuid
          required: true
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Chưa đăng nhập
  /api/notifications/mark-all-read:
    post:
      tags:
        - Notifications
      summary: Đánh dấu toàn bộ thông báo đã đọc
      security:
        - sessionAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '401':
          description: Chưa đăng nhập
  /login:
    get:
      tags:
        - Auth
      summary: Trang đăng nhập bằng email/mật khẩu
      responses:
        '200':
          description: HTML form đăng nhập
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Auth
      summary: Đăng nhập bằng email và mật khẩu
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '302':
          description: Đăng nhập thành công, chuyển hướng về trang trước hoặc trang chủ
        '422':
          description: Sai thông tin đăng nhập/thiếu dữ liệu
  /logout:
    post:
      tags:
        - Auth
      summary: Đăng xuất khỏi hệ thống
      security:
        - sessionAuth: []
      responses:
        '302':
          description: Chuyển hướng về trang chủ sau khi đăng xuất
  /register:
    get:
      tags:
        - Auth
      summary: Trang đăng ký tài khoản mới
      responses:
        '200':
          description: HTML form đăng ký
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Auth
      summary: Đăng ký tài khoản mới
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '302':
          description: Đăng ký thành công và đăng nhập luôn, chuyển hướng về trang chủ
        '422':
          description: Thiếu hoặc sai dữ liệu, trả về cùng form
  /auth/google/redirect:
    get:
      tags:
        - Auth
      summary: Chuyển hướng người dùng tới Google OAuth
      responses:
        '302':
          description: Chuyển hướng tới Google
  /auth/google/callback:
    get:
      tags:
        - Auth
      summary: Điểm nhận callback từ Google OAuth
      responses:
        '302':
          description: Tạo/đăng nhập user rồi chuyển hướng về trang chủ
  /login/phone:
    get:
      tags:
        - Auth
      summary: Trang đăng nhập bằng OTP qua điện thoại
      responses:
        '200':
          description: HTML form nhập số điện thoại
          content:
            text/html:
              schema:
                type: string
  /login/phone/send:
    post:
      tags:
        - Auth
      summary: Gửi mã OTP về số điện thoại đã đăng ký
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PhoneOtpRequest'
      responses:
        '302':
          description: Chuyển hướng tới trang nhập OTP cùng với thông báo trạng thái gửi
        '422':
          description: Số điện thoại không hợp lệ hoặc chưa đăng ký
  /login/phone/verify:
    get:
      tags:
        - Auth
      summary: Trang nhập mã OTP vừa được gửi
      responses:
        '200':
          description: HTML form nhập OTP 6 chữ số
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Auth
      summary: Xác minh OTP và đăng nhập
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PhoneOtpVerifyRequest'
      responses:
        '302':
          description: Đăng nhập thành công, chuyển về trang trước
        '422':
          description: OTP hết hạn hoặc không khớp
  /:
    get:
      tags:
        - Frontend
      summary: Trang chủ Cinemat
      responses:
        '200':
          description: HTML trang chủ với phim nổi bật, đang chiếu, khuyến mãi
          content:
            text/html:
              schema:
                type: string
  /movies:
    get:
      tags:
        - Frontend
      summary: Danh sách phim đang chiếu/sắp chiếu (giao diện người dùng)
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum:
              - NOW_SHOWING
              - COMING_SOON
              - ENDED
          description: Lọc theo trạng thái phim
        - in: query
          name: genre
          schema:
            type: string
          description: Từ khóa thể loại (ví dụ Hành động)
      responses:
        '200':
          description: HTML danh sách phim kèm phân trang
          content:
            text/html:
              schema:
                type: string
  /movies/{movie}:
    get:
      tags:
        - Frontend
      summary: Trang chi tiết phim và lịch chiếu
      parameters:
        - in: path
          name: movie
          required: true
          schema:
            type: integer
        - in: query
          name: cinema_id
          schema:
            type: integer
          description: Lọc lịch chiếu theo rạp
        - in: query
          name: date
          schema:
            type: string
            format: date
          description: Lọc theo ngày chiếu cụ thể
        - in: query
          name: city
          schema:
            type: string
          description: Lọc theo thành phố đặt rạp
      responses:
        '200':
          description: HTML thông tin phim và lịch chiếu theo ngày
          content:
            text/html:
              schema:
                type: string
  /booking/{showtime}:
    get:
      tags:
        - Booking
      summary: Trang chọn ghế và đặt vé cho một suất chiếu
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: showtime
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML hiển thị sơ đồ ghế, giá, thông tin phòng
          content:
            text/html:
              schema:
                type: string
        '302':
          description: Chuyển hướng tới login nếu chưa đăng nhập
  /booking:
    post:
      tags:
        - Booking
      summary: Tạo booking mới dựa trên ghế đã chọn
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/BookingRequest'
      responses:
        '302':
          description: Thành công sẽ chuyển hướng sang trang thanh toán của booking
        '422':
          description: Ghế không hợp lệ hoặc đã được giữ
  /payment/{booking}:
    get:
      tags:
        - Payment
      summary: Trang chọn phương thức thanh toán cho booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML hướng dẫn thanh toán VNPay hoặc demo
          content:
            text/html:
              schema:
                type: string
        '302':
          description: Chuyển hướng về trang chủ nếu booking không ở trạng thái PENDING
  /payment/vnpay:
    post:
      tags:
        - Payment
      summary: Khởi tạo giao dịch VNPay cho booking đang chờ thanh toán
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              allOf:
                - $ref: '#/components/schemas/PaymentMethodRequest'
                - type: object
                  properties:
                    booking_id:
                      type: integer
                      description: ID booking cần thanh toán
      responses:
        '302':
          description: Chuyển hướng tới cổng VNPay
        '422':
          description: Thiếu booking hoặc phương thức không hợp lệ
  /payment/demo/{booking}:
    get:
      tags:
        - Payment
      summary: Trang demo thanh toán nội bộ (không gọi VNPay)
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
        - in: query
          name: method
          schema:
            type: string
            enum:
              - vnpay_qr
              - vnpay_atm
              - vnpay_card
          description: Tùy chọn hiển thị phương thức demo mặc định
      responses:
        '200':
          description: HTML mô phỏng kết quả thanh toán
          content:
            text/html:
              schema:
                type: string
  /payment/demo/{booking}/process:
    post:
      tags:
        - Payment
      summary: Mô phỏng thành công/thất bại cho booking đang test
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/DemoPaymentRequest'
      responses:
        '302':
          description: Thành công sẽ chuyển tới trang vé, thất bại quay lại trang thanh toán
  /payment/vnpay/return:
    get:
      tags:
        - Payment
      summary: VNPay redirect URL sau khi người dùng thanh toán
      parameters:
        - in: query
          name: vnp_TxnRef
          schema:
            type: string
          description: Mã booking ban đầu
        - in: query
          name: vnp_ResponseCode
          schema:
            type: string
        - in: query
          name: vnp_SecureHash
          schema:
            type: string
        - in: query
          name: vnp_Amount
          schema:
            type: integer
            description: Số tiền * 100 theo chuẩn VNPay
      responses:
        '302':
          description: Tùy theo trạng thái giao dịch sẽ chuyển tới trang vé hoặc quay về trang thanh toán cùng thông báo
  /payment/vnpay/ipn:
    post:
      tags:
        - Payment
      summary: Endpoint IPN nhận thông báo thanh toán từ VNPay
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              additionalProperties:
                type: string
              description: Toàn bộ payload vnp_* do VNPay gửi (bao gồm vnp_TxnRef, vnp_Amount, vnp_SecureHash...)
      responses:
        '200':
          description: JSON theo chuẩn VNPay (`RspCode`, `Message`)
          content:
            application/json:
              schema:
                type: object
                properties:
                  RspCode:
                    type: string
                  Message:
                    type: string
  /check-in:
    get:
      tags:
        - Check-in
      summary: Trang tự check-in cho khách hàng
      responses:
        '200':
          description: HTML form nhập mã vé
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Check-in
      summary: Kiểm tra mã vé và đánh dấu đã sử dụng (tự phục vụ)
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CheckInRequest'
      responses:
        '200':
          description: HTML trang thành công với thông tin vé
          content:
            text/html:
              schema:
                type: string
        '302':
          description: Trả về form ban đầu kèm lỗi nếu mã không hợp lệ
  /check-in/ticket/{ticketCode}:
    get:
      tags:
        - Check-in
      summary: Xem chi tiết vé vừa check-in
      parameters:
        - in: path
          name: ticketCode
          required: true
          schema:
            type: string
      responses:
        '200':
          description: HTML thông tin vé, lịch chiếu, ghế
          content:
            text/html:
              schema:
                type: string
  /tickets/booking/{booking}:
    get:
      tags:
        - Tickets
      summary: Xem toàn bộ vé thuộc booking (yêu cầu đăng nhập)
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML danh sách vé với QR/mã code
          content:
            text/html:
              schema:
                type: string
        '403':
          description: User không sở hữu booking
  /tickets/{ticket}:
    get:
      tags:
        - Tickets
      summary: Xem chi tiết một vé cụ thể
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: ticket
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết vé và thông tin check-in
          content:
            text/html:
              schema:
                type: string
        '403':
          description: Không có quyền truy cập
  /my-tickets:
    get:
      tags:
        - My Tickets
      summary: Trung tâm vé của người dùng (phân trang)
      security:
        - sessionAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum:
              - PENDING
              - CONFIRMED
              - CANCELLED
              - EXPIRED
        - in: query
          name: movie_id
          schema:
            type: integer
      responses:
        '200':
          description: HTML danh sách booking, bộ lọc và thống kê nhanh
          content:
            text/html:
              schema:
                type: string
        '302':
          description: Nếu chưa đăng nhập sẽ chuyển hướng sang trang login
  /my-tickets/{booking}/cancel:
    post:
      tags:
        - My Tickets
      summary: Hủy booking của chính người dùng (khi chưa thanh toán)
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '302':
          description: Chuyển hướng về trang trước với thông báo thành công/thất bại
        '403':
          description: Không phải chủ sở hữu booking
  /admin:
    get:
      tags:
        - Admin
      summary: Dashboard tổng quan cho quản trị viên
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML dashboard (thống kê doanh thu, vé, tình trạng phòng chiếu)
          content:
            text/html:
              schema:
                type: string
  /admin/reports:
    get:
      tags:
        - Admin
      summary: Trang chọn báo cáo quản trị
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML danh sách báo cáo
          content:
            text/html:
              schema:
                type: string
  /admin/reports/revenue:
    get:
      tags:
        - Admin
      summary: Báo cáo doanh thu chi tiết
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML biểu đồ/ bảng doanh thu
          content:
            text/html:
              schema:
                type: string
  /admin/reports/bookings:
    get:
      tags:
        - Admin
      summary: Báo cáo đặt vé theo suất chiếu
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML thống kê booking
          content:
            text/html:
              schema:
                type: string
  /admin/movies:
    get:
      tags:
        - Admin
      summary: Danh sách phim nội bộ
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML bảng phim
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Admin
      summary: Tạo phim mới
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AdminMovieRequest'
      responses:
        '302':
          description: Tạo thành công chuyển về danh sách
        '422':
          description: Dữ liệu không hợp lệ
  /admin/movies/create:
    get:
      tags:
        - Admin
      summary: Form thêm phim
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/movies/{movie}:
    get:
      tags:
        - Admin
      summary: Chi tiết phim
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: movie
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết phim
          content:
            text/html:
              schema:
                type: string
    put:
      tags:
        - Admin
      summary: Cập nhật thông tin phim
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: movie
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AdminMovieRequest'
      responses:
        '302':
          description: Cập nhật thành công
        '422':
          description: Dữ liệu không hợp lệ
    patch:
      tags:
        - Admin
      summary: Cập nhật một phần thông tin phim
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: movie
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AdminMovieRequest'
      responses:
        '302':
          description: Cập nhật thành công
    delete:
      tags:
        - Admin
      summary: Xóa phim
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: movie
          required: true
          schema:
            type: integer
      responses:
        '302':
          description: Xóa thành công về danh sách
  /admin/movies/{movie}/edit:
    get:
      tags:
        - Admin
      summary: Form chỉnh sửa phim
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: movie
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML form chỉnh sửa
          content:
            text/html:
              schema:
                type: string
  /admin/cinemas:
    get:
      tags:
        - Admin
      summary: Danh sách rạp
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML bảng rạp
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Admin
      summary: Thêm rạp mới
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CinemaRequest'
      responses:
        '302':
          description: Tạo thành công
  /admin/cinemas/create:
    get:
      tags:
        - Admin
      summary: Form thêm rạp
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/cinemas/{cinema}:
    get:
      tags:
        - Admin
      summary: Chi tiết rạp
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: cinema
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết rạp
          content:
            text/html:
              schema:
                type: string
    put:
      tags:
        - Admin
      summary: Cập nhật rạp
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: cinema
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CinemaRequest'
      responses:
        '302':
          description: Cập nhật thành công
    patch:
      tags:
        - Admin
      summary: Cập nhật nhanh rạp
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: cinema
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CinemaRequest'
      responses:
        '302':
          description: Cập nhật thành công
    delete:
      tags:
        - Admin
      summary: Xóa rạp
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: cinema
          required: true
          schema:
            type: integer
      responses:
        '302':
          description: Xóa thành công
  /admin/cinemas/{cinema}/edit:
    get:
      tags:
        - Admin
      summary: Form chỉnh sửa rạp
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: cinema
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML form chỉnh sửa
          content:
            text/html:
              schema:
                type: string
  /admin/rooms:
    get:
      tags:
        - Admin
      summary: Danh sách phòng chiếu
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML bảng phòng
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Admin
      summary: Thêm phòng
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RoomRequest'
      responses:
        '302':
          description: Thêm thành công
  /admin/rooms/create:
    get:
      tags:
        - Admin
      summary: Form thêm phòng
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/rooms/{room}:
    get:
      tags:
        - Admin
      summary: Chi tiết phòng
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: room
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết phòng, danh sách ghế
          content:
            text/html:
              schema:
                type: string
    put:
      tags:
        - Admin
      summary: Cập nhật phòng
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: room
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RoomRequest'
      responses:
        '302':
          description: Cập nhật thành công
    patch:
      tags:
        - Admin
      summary: Cập nhật nhanh phòng
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: room
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RoomRequest'
      responses:
        '302':
          description: Cập nhật thành công
    delete:
      tags:
        - Admin
      summary: Xóa phòng
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: room
          required: true
          schema:
            type: integer
      responses:
        '302':
          description: Xóa thành công
  /admin/rooms/{room}/edit:
    get:
      tags:
        - Admin
      summary: Form chỉnh sửa phòng
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: room
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/showtimes:
    get:
      tags:
        - Admin
      summary: Danh sách lịch chiếu
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML bảng lịch chiếu
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Admin
      summary: Tạo lịch chiếu mới
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ShowtimeRequest'
      responses:
        '302':
          description: Tạo thành công
  /admin/showtimes/create:
    get:
      tags:
        - Admin
      summary: Form tạo lịch chiếu
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/showtimes/{showtime}:
    get:
      tags:
        - Admin
      summary: Chi tiết lịch chiếu
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: showtime
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết
          content:
            text/html:
              schema:
                type: string
    put:
      tags:
        - Admin
      summary: Cập nhật lịch chiếu
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: showtime
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ShowtimeRequest'
      responses:
        '302':
          description: Cập nhật thành công
    patch:
      tags:
        - Admin
      summary: Cập nhật nhanh lịch chiếu
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: showtime
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ShowtimeRequest'
      responses:
        '302':
          description: Cập nhật thành công
    delete:
      tags:
        - Admin
      summary: Xóa lịch chiếu
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: showtime
          required: true
          schema:
            type: integer
      responses:
        '302':
          description: Xóa thành công
  /admin/showtimes/{showtime}/edit:
    get:
      tags:
        - Admin
      summary: Form chỉnh sửa lịch chiếu
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: showtime
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/bookings:
    get:
      tags:
        - Admin
      summary: Quản lý danh sách booking
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML bảng booking
          content:
            text/html:
              schema:
                type: string
  /admin/bookings/{booking}:
    get:
      tags:
        - Admin
      summary: Chi tiết booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết booking và vé
          content:
            text/html:
              schema:
                type: string
    put:
      tags:
        - Admin
      summary: Cập nhật trạng thái/thông tin thanh toán booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AdminBookingUpdateRequest'
      responses:
        '302':
          description: Cập nhật thành công
    patch:
      tags:
        - Admin
      summary: Cập nhật một phần booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AdminBookingUpdateRequest'
      responses:
        '302':
          description: Cập nhật thành công
    delete:
      tags:
        - Admin
      summary: Xóa booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '302':
          description: Xóa thành công
  /admin/bookings/{booking}/edit:
    get:
      tags:
        - Admin
      summary: Form chỉnh sửa booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML form
          content:
            text/html:
              schema:
                type: string
  /admin/bookings/{booking}/inline-status:
    patch:
      tags:
        - Admin
      summary: Cập nhật nhanh trạng thái booking (AJAX)
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InlineStatusRequest'
      responses:
        '200':
          description: JSON trả về trạng thái mới
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: string
  /staff:
    get:
      tags:
        - Staff
      summary: Dashboard dành cho nhân viên (admin + staff middleware)
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML dashboard
          content:
            text/html:
              schema:
                type: string
  /staff/bookings:
    get:
      tags:
        - Staff
      summary: Danh sách booking để nhân viên hỗ trợ
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML bảng booking
          content:
            text/html:
              schema:
                type: string
  /staff/bookings/{booking}:
    get:
      tags:
        - Staff
      summary: Chi tiết booking cho nhân viên
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: HTML chi tiết booking
          content:
            text/html:
              schema:
                type: string
  /staff/bookings/{booking}/status:
    patch:
      tags:
        - Staff
      summary: Nhân viên cập nhật trạng thái booking
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: booking
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/StaffBookingStatusRequest'
      responses:
        '302':
          description: Quay lại trang trước với thông báo
  /staff/check-in:
    get:
      tags:
        - Staff
      summary: Form check-in cho nhân viên soát vé
      security:
        - sessionAuth: []
      responses:
        '200':
          description: HTML form nhập mã vé
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Staff
      summary: Nhập mã vé và đánh dấu đã sử dụng (không giới hạn thời gian)
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CheckInRequest'
      responses:
        '200':
          description: HTML thông tin vé sau khi check-in
          content:
            text/html:
              schema:
                type: string
  /staff/check-in/ticket/{ticketCode}:
    get:
      tags:
        - Staff
      summary: Tra cứu vé theo mã cho nhân viên
      security:
        - sessionAuth: []
      parameters:
        - in: path
          name: ticketCode
          required: true
          schema:
            type: string
      responses:
        '200':
          description: HTML thông tin vé
          content:
            text/html:
              schema:
                type: string
  /broadcasting/auth:
    post:
      tags:
        - Broadcast
      summary: Xác thực kênh private/presence cho Laravel Echo/Pusher
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                socket_id:
                  type: string
                channel_name:
                  type: string
      responses:
        '200':
          description: Payload ký tên cho client subscribe channel
          content:
            application/json:
              schema:
                type: object
*** End Patch

